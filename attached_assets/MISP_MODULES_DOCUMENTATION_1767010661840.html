<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCPWave MISP Modules - Complete Documentation</title>
    <style>
        :root {
            --primary: #0066cc;
            --primary-dark: #004080;
            --secondary: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --dark: #343a40;
            --light: #f8f9fa;
            --border: #dee2e6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 40px 20px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        header .version {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        /* Navigation */
        nav {
            background: var(--dark);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-size: 0.95rem;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        nav a:hover {
            background: rgba(255,255,255,0.1);
        }

        /* Sections */
        section {
            padding: 40px 0;
            border-bottom: 1px solid var(--border);
        }

        section:last-child {
            border-bottom: none;
        }

        h2 {
            color: var(--primary-dark);
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            display: inline-block;
        }

        h3 {
            color: var(--dark);
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: #555;
            font-size: 1.1rem;
            margin: 20px 0 10px 0;
        }

        p {
            margin-bottom: 15px;
        }

        /* Code blocks */
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            color: #c7254e;
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        .code-comment { color: #6a9955; }
        .code-keyword { color: #569cd6; }
        .code-string { color: #ce9178; }
        .code-function { color: #dcdcaa; }
        .code-class { color: #4ec9b0; }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.95rem;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid var(--border);
        }

        th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e9ecef;
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .card h4 {
            margin-top: 0;
            color: var(--primary);
        }

        .card p {
            color: #666;
            font-size: 0.95rem;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-expansion { background: var(--secondary); color: white; }
        .badge-export { background: var(--info); color: white; }
        .badge-import { background: var(--warning); color: #333; }
        .badge-action { background: var(--danger); color: white; }
        .badge-success { background: var(--secondary); color: white; }
        .badge-pass { background: #28a745; color: white; }

        /* Alert boxes */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid;
        }

        .alert-info {
            background: #e7f3ff;
            border-color: var(--info);
            color: #0c5460;
        }

        .alert-success {
            background: #d4edda;
            border-color: var(--secondary);
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: var(--warning);
            color: #856404;
        }

        /* Lists */
        ul, ol {
            margin: 15px 0 15px 30px;
        }

        li {
            margin: 8px 0;
        }

        /* Architecture diagram */
        .architecture-diagram {
            background: #f8f9fa;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            font-family: 'Consolas', monospace;
            white-space: pre;
            overflow-x: auto;
            line-height: 1.4;
        }

        /* Stats box */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .number {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .stat-box .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Test results */
        .test-round {
            background: #f8f9fa;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .test-round h4 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0;
        }

        .test-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }

        .test-item {
            background: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .test-item::before {
            content: "✓";
            color: var(--secondary);
            font-weight: bold;
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 30px 20px;
            text-align: center;
            margin-top: 40px;
        }

        footer a {
            color: var(--info);
        }

        /* Print styles */
        @media print {
            nav { display: none; }
            .card:hover { transform: none; }
            section { page-break-inside: avoid; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            header h1 { font-size: 1.8rem; }
            h2 { font-size: 1.5rem; }
            nav ul { flex-direction: column; align-items: center; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

<header>
    <h1>TCPWave MISP Modules</h1>
    <p class="subtitle">AI-Powered Threat Intelligence Integration for MISP</p>
    <span class="version">Version 1.0.0 | December 2025</span>
</header>

<nav>
    <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#architecture">Architecture</a></li>
        <li><a href="#modules">Modules</a></li>
        <li><a href="#api">API Reference</a></li>
        <li><a href="#mcp">FastMCP</a></li>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#configuration">Configuration</a></li>
        <li><a href="#testing">Testing</a></li>
        <li><a href="#examples">Examples</a></li>
    </ul>
</nav>

<div class="container">

    <!-- Overview Section -->
    <section id="overview">
        <h2>Overview</h2>

        <p>TCPWave MISP Modules is a comprehensive suite of Python modules that extend MISP (Malware Information Sharing Platform) with advanced AI-powered threat intelligence capabilities. Built on FastAPI and integrated with TCPWave's ATLANTIS deep learning system, these modules provide real-time DGA detection, threat enrichment, and seamless integration with enterprise security workflows.</p>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="number">16</div>
                <div class="label">Total Modules</div>
            </div>
            <div class="stat-box">
                <div class="number">5</div>
                <div class="label">Expansion Modules</div>
            </div>
            <div class="stat-box">
                <div class="number">4</div>
                <div class="label">Export Modules</div>
            </div>
            <div class="stat-box">
                <div class="number">3</div>
                <div class="label">Import Modules</div>
            </div>
            <div class="stat-box">
                <div class="number">4</div>
                <div class="label">Action Modules</div>
            </div>
            <div class="stat-box">
                <div class="number">100%</div>
                <div class="label">Test Pass Rate</div>
            </div>
        </div>

        <h3>Key Features</h3>
        <ul>
            <li><strong>ATLANTIS DGA Detection</strong> - CNN+LSTM neural network for domain classification with 136+ DGA family recognition</li>
            <li><strong>Statistical Anomaly Detection</strong> - Real-time DNS traffic analysis using Shannon entropy and n-gram analysis</li>
            <li><strong>Multi-Source Threat Enrichment</strong> - Integration with VirusTotal, AbuseIPDB, Shodan, GreyNoise, and more</li>
            <li><strong>STIX 2.1 Support</strong> - Full import/export capability for threat intelligence sharing</li>
            <li><strong>FastMCP Integration</strong> - Expose all modules as AI tools via Model Context Protocol</li>
            <li><strong>Real-Time Actions</strong> - Slack, email, webhook notifications and TCPWave IPAM synchronization</li>
        </ul>

        <div class="alert alert-info">
            <strong>MISP Compatibility:</strong> All modules follow the official MISP modules API specification and can be used as drop-in replacements for standard MISP modules.
        </div>
    </section>

    <!-- Architecture Section -->
    <section id="architecture">
        <h2>System Architecture</h2>

        <div class="architecture-diagram">
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           TCPWave MISP Modules                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐              │
│  │   FastAPI       │    │   FastMCP       │    │   Web UI        │              │
│  │   REST API      │    │   MCP Server    │    │   Dashboard     │              │
│  │   Port 6666     │    │   stdio/SSE     │    │   Bootstrap 5   │              │
│  └────────┬────────┘    └────────┬────────┘    └────────┬────────┘              │
│           │                      │                      │                        │
│           └──────────────────────┼──────────────────────┘                        │
│                                  │                                               │
│  ┌───────────────────────────────┴───────────────────────────────┐              │
│  │                      Module Registry                           │              │
│  │           (Lazy Loading, Caching, Type Routing)               │              │
│  └───────────────────────────────┬───────────────────────────────┘              │
│                                  │                                               │
│  ┌───────────┬───────────┬───────┴───────┬───────────┐                          │
│  │           │           │               │           │                          │
│  ▼           ▼           ▼               ▼           ▼                          │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐                     │
│ │Expansion│ │ Export  │ │ Import  │ │ Action  │ │  Hover  │                     │
│ │ Modules │ │ Modules │ │ Modules │ │ Modules │ │ Modules │                     │
│ └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └─────────┘                     │
│      │           │           │           │                                       │
└──────┼───────────┼───────────┼───────────┼───────────────────────────────────────┘
       │           │           │           │
       ▼           ▼           ▼           ▼
┌──────────────────────────────────────────────────────────────────────────────────┐
│                           External Services                                       │
├──────────────┬──────────────┬──────────────┬──────────────┬─────────────────────┤
│  ATLANTIS    │  Threat      │  STIX/TAXII  │  TCPWave     │  Notification       │
│  DGA API     │  Intel APIs  │  Servers     │  IPAM        │  Services           │
│  Port 8888   │  VT, Shodan  │              │              │  Slack, Email       │
└──────────────┴──────────────┴──────────────┴──────────────┴─────────────────────┘
        </div>

        <h3>Directory Structure</h3>
        <pre>
misp-modules/
├── core/                      # Core framework
│   ├── __init__.py           # Package exports
│   ├── base.py               # Base classes (MISPModule, MISPAttribute, etc.)
│   ├── registry.py           # ModuleRegistry for module management
│   ├── loader.py             # Dynamic module discovery and loading
│   ├── config.py             # Configuration management (Pydantic/dataclass)
│   └── exceptions.py         # Custom exception classes
│
├── modules/                   # Module implementations
│   ├── expansion/            # Attribute enrichment modules
│   │   ├── atlantis_dga.py   # ATLANTIS DGA detection
│   │   ├── dns_anomaly.py    # Statistical anomaly detection
│   │   ├── threat_enrichment.py  # Multi-source enrichment
│   │   ├── domain_intel.py   # Domain intelligence
│   │   └── ip_reputation.py  # IP reputation analysis
│   │
│   ├── export/               # Data export modules
│   │   ├── atlantis_export.py    # ATLANTIS training format
│   │   ├── stix_export.py    # STIX 2.1 bundle export
│   │   ├── threat_feed.py    # JSON/TXT threat feeds
│   │   └── csv_export.py     # CSV IOC export
│   │
│   ├── import/               # Data import modules
│   │   ├── csv_import.py     # CSV IOC import
│   │   ├── stix_import.py    # STIX bundle import
│   │   └── otx_import.py     # AlienVault OTX import
│   │
│   └── action/               # Workflow action modules
│       ├── slack_notify.py   # Slack notifications
│       ├── webhook_action.py # Generic webhook calls
│       ├── email_alert.py    # Email alerting
│       └── tcpwave_sync.py   # TCPWave IPAM sync
│
├── server.py                 # FastAPI application server
├── mcp_server.py             # FastMCP standalone server
├── static/
│   └── index.html            # Web dashboard
├── tests/
│   ├── test_qa.py            # Original QA tests
│   └── test_5_rounds.py      # Comprehensive 5-round test suite
├── requirements.txt          # Python dependencies
└── pytest.ini                # Pytest configuration
        </pre>
    </section>

    <!-- Modules Section -->
    <section id="modules">
        <h2>Module Reference</h2>

        <h3>Expansion Modules</h3>
        <p>Expansion modules enrich MISP attributes with additional threat intelligence and analysis.</p>

        <div class="card-grid">
            <div class="card">
                <h4><span class="badge badge-expansion">Expansion</span> atlantis_dga</h4>
                <p><strong>ATLANTIS DGA Detection</strong></p>
                <p>Analyzes domains using TCPWave's CNN+LSTM neural network to detect Domain Generation Algorithm (DGA) patterns.</p>
                <p><strong>Input:</strong> domain, hostname<br>
                <strong>Output:</strong> text, comment, x-tcpwave-dga-*</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>136+ DGA family classification</li>
                    <li>Binary and multiclass modes</li>
                    <li>Confidence scoring</li>
                    <li>Batch processing support</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-expansion">Expansion</span> dns_anomaly</h4>
                <p><strong>DNS Anomaly Detection</strong></p>
                <p>Statistical analysis of domain names using entropy, n-gram frequency, and character distribution.</p>
                <p><strong>Input:</strong> domain, hostname<br>
                <strong>Output:</strong> text, comment, x-tcpwave-dns-anomaly</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>Shannon entropy analysis</li>
                    <li>Consonant ratio detection</li>
                    <li>Digit concentration scoring</li>
                    <li>No external dependencies</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-expansion">Expansion</span> threat_enrichment</h4>
                <p><strong>Multi-Source Enrichment</strong></p>
                <p>Aggregates threat intelligence from multiple external sources for comprehensive indicator analysis.</p>
                <p><strong>Input:</strong> domain, ip-dst, ip-src, url, md5, sha256<br>
                <strong>Output:</strong> text, link, comment</p>
                <p><strong>Sources:</strong></p>
                <ul>
                    <li>VirusTotal</li>
                    <li>AbuseIPDB</li>
                    <li>Shodan</li>
                    <li>GreyNoise</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-expansion">Expansion</span> domain_intel</h4>
                <p><strong>Domain Intelligence</strong></p>
                <p>Comprehensive domain analysis including WHOIS, DNS records, and registration information.</p>
                <p><strong>Input:</strong> domain, hostname<br>
                <strong>Output:</strong> text, whois-*, ip-dst, AS</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>WHOIS lookup</li>
                    <li>DNS resolution</li>
                    <li>Age analysis</li>
                    <li>Registrar information</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-expansion">Expansion</span> ip_reputation</h4>
                <p><strong>IP Reputation Analysis</strong></p>
                <p>Analyzes IP addresses for reputation, geolocation, and network information.</p>
                <p><strong>Input:</strong> ip-dst, ip-src<br>
                <strong>Output:</strong> text, AS, country-code, comment</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>GeoIP lookup</li>
                    <li>ASN information</li>
                    <li>Private IP detection</li>
                    <li>Reputation scoring</li>
                </ul>
            </div>
        </div>

        <h3>Export Modules</h3>
        <p>Export modules convert MISP events and attributes to various formats for sharing and analysis.</p>

        <div class="card-grid">
            <div class="card">
                <h4><span class="badge badge-export">Export</span> atlantis_export</h4>
                <p><strong>ATLANTIS Training Format</strong></p>
                <p>Exports domains in CSV format suitable for training the ATLANTIS DGA detection model.</p>
                <p><strong>Format:</strong> <code>domain,class,label</code></p>
                <p><strong>Modes:</strong></p>
                <ul>
                    <li>Binary (0=legit, 1=malicious)</li>
                    <li>Multiclass (DGA family labels)</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-export">Export</span> stix_export</h4>
                <p><strong>STIX 2.1 Bundle Export</strong></p>
                <p>Converts MISP events to STIX 2.1 format for threat intelligence sharing.</p>
                <p><strong>Objects:</strong></p>
                <ul>
                    <li>Indicators (patterns)</li>
                    <li>Observable objects</li>
                    <li>Relationships</li>
                    <li>Identity objects</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-export">Export</span> threat_feed</h4>
                <p><strong>Threat Feed Generation</strong></p>
                <p>Creates threat feeds in JSON or plain text format for integration with security tools.</p>
                <p><strong>Formats:</strong></p>
                <ul>
                    <li>JSON with metadata</li>
                    <li>Plain text IOC list</li>
                    <li>Filtered by type</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-export">Export</span> csv_export</h4>
                <p><strong>CSV IOC Export</strong></p>
                <p>Simple CSV export of indicators with customizable columns.</p>
                <p><strong>Columns:</strong> type, value, category, to_ids, comment, tags</p>
            </div>
        </div>

        <h3>Import Modules</h3>
        <p>Import modules ingest external threat intelligence data into MISP format.</p>

        <div class="card-grid">
            <div class="card">
                <h4><span class="badge badge-import">Import</span> csv_import</h4>
                <p><strong>CSV IOC Import</strong></p>
                <p>Imports indicators from CSV files with automatic type detection.</p>
                <p><strong>Required columns:</strong> value, type<br>
                <strong>Optional:</strong> comment, tags, category</p>
            </div>

            <div class="card">
                <h4><span class="badge badge-import">Import</span> stix_import</h4>
                <p><strong>STIX Bundle Import</strong></p>
                <p>Parses STIX 2.1 bundles and converts indicators to MISP attributes.</p>
                <p><strong>Supported:</strong></p>
                <ul>
                    <li>Indicator patterns</li>
                    <li>Observable objects</li>
                    <li>Domain, IP, URL, hash</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-import">Import</span> otx_import</h4>
                <p><strong>AlienVault OTX Import</strong></p>
                <p>Fetches and imports pulses from AlienVault Open Threat Exchange.</p>
                <p><strong>Requires:</strong> OTX API Key</p>
            </div>
        </div>

        <h3>Action Modules</h3>
        <p>Action modules trigger workflows and notifications based on MISP events.</p>

        <div class="card-grid">
            <div class="card">
                <h4><span class="badge badge-action">Action</span> slack_notify</h4>
                <p><strong>Slack Notifications</strong></p>
                <p>Sends formatted threat alerts to Slack channels via webhooks.</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>Rich message formatting</li>
                    <li>Severity filtering</li>
                    <li>Custom channel routing</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-action">Action</span> email_alert</h4>
                <p><strong>Email Alerting</strong></p>
                <p>Sends threat alerts via SMTP email with HTML formatting.</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>HTML email templates</li>
                    <li>Multiple recipients</li>
                    <li>Severity thresholds</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-action">Action</span> webhook_action</h4>
                <p><strong>Generic Webhook</strong></p>
                <p>Sends event data to any HTTP endpoint for custom integrations.</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>Custom headers</li>
                    <li>HMAC signing</li>
                    <li>Retry logic</li>
                </ul>
            </div>

            <div class="card">
                <h4><span class="badge badge-action">Action</span> tcpwave_sync</h4>
                <p><strong>TCPWave IPAM Sync</strong></p>
                <p>Synchronizes threat indicators with TCPWave IPAM for DNS/DHCP blocking.</p>
                <p><strong>Actions:</strong></p>
                <ul>
                    <li>Block malicious domains</li>
                    <li>Block malicious IPs</li>
                    <li>Update DNS policies</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- API Section -->
    <section id="api">
        <h2>REST API Reference</h2>

        <p>The MISP Modules server exposes a REST API compatible with the standard MISP modules protocol.</p>

        <h3>Base URL</h3>
        <pre>http://localhost:6666</pre>

        <h3>Endpoints</h3>

        <table>
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Endpoint</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>GET</code></td>
                    <td><code>/modules</code></td>
                    <td>List all available modules with their metadata</td>
                </tr>
                <tr>
                    <td><code>POST</code></td>
                    <td><code>/query</code></td>
                    <td>Execute an expansion module on an attribute</td>
                </tr>
                <tr>
                    <td><code>GET</code></td>
                    <td><code>/modules/{name}</code></td>
                    <td>Get detailed information about a specific module</td>
                </tr>
                <tr>
                    <td><code>GET</code></td>
                    <td><code>/stats</code></td>
                    <td>Get server statistics and module counts</td>
                </tr>
                <tr>
                    <td><code>GET</code></td>
                    <td><code>/health</code></td>
                    <td>Health check endpoint</td>
                </tr>
                <tr>
                    <td><code>GET</code></td>
                    <td><code>/docs</code></td>
                    <td>OpenAPI/Swagger documentation</td>
                </tr>
            </tbody>
        </table>

        <h3>Query Request Format</h3>
        <pre>
<span class="code-keyword">POST</span> /query
<span class="code-keyword">Content-Type:</span> application/json

{
    <span class="code-string">"module"</span>: <span class="code-string">"atlantis_dga"</span>,
    <span class="code-string">"attribute"</span>: {
        <span class="code-string">"type"</span>: <span class="code-string">"domain"</span>,
        <span class="code-string">"value"</span>: <span class="code-string">"suspicious-domain.com"</span>
    },
    <span class="code-string">"config"</span>: {
        <span class="code-string">"include_family"</span>: <span class="code-keyword">true</span>
    }
}
        </pre>

        <h3>Query Response Format</h3>
        <pre>
{
    <span class="code-string">"results"</span>: [
        {
            <span class="code-string">"types"</span>: [<span class="code-string">"text"</span>],
            <span class="code-string">"values"</span>: [<span class="code-string">"DGA detected: conficker family (confidence: 0.95)"</span>],
            <span class="code-string">"comment"</span>: <span class="code-string">"Analyzed by ATLANTIS DGA Detection"</span>
        }
    ],
    <span class="code-string">"success"</span>: <span class="code-keyword">true</span>,
    <span class="code-string">"execution_time_ms"</span>: <span class="code-keyword">45.2</span>
}
        </pre>

        <h3>Error Response Format</h3>
        <pre>
{
    <span class="code-string">"error"</span>: <span class="code-string">"Module not found: invalid_module"</span>,
    <span class="code-string">"success"</span>: <span class="code-keyword">false</span>
}
        </pre>
    </section>

    <!-- FastMCP Section -->
    <section id="mcp">
        <h2>FastMCP Integration</h2>

        <p>All MISP modules are exposed as AI tools via the Model Context Protocol (MCP), enabling seamless integration with Claude and other AI assistants.</p>

        <h3>Available MCP Tools</h3>

        <table>
            <thead>
                <tr>
                    <th>Tool Name</th>
                    <th>Description</th>
                    <th>Parameters</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>analyze_domain_dga</code></td>
                    <td>Analyze domain for DGA patterns using ATLANTIS</td>
                    <td>domain (str), include_family (bool)</td>
                </tr>
                <tr>
                    <td><code>detect_dns_anomaly</code></td>
                    <td>Statistical anomaly detection for domains</td>
                    <td>domain (str)</td>
                </tr>
                <tr>
                    <td><code>enrich_indicator</code></td>
                    <td>Multi-source threat enrichment</td>
                    <td>indicator (str), type (str), sources (list)</td>
                </tr>
                <tr>
                    <td><code>get_domain_intelligence</code></td>
                    <td>Comprehensive domain intel (WHOIS, DNS)</td>
                    <td>domain (str), resolve_dns (bool)</td>
                </tr>
                <tr>
                    <td><code>check_ip_reputation</code></td>
                    <td>IP reputation and geolocation</td>
                    <td>ip (str)</td>
                </tr>
                <tr>
                    <td><code>batch_analyze_dga</code></td>
                    <td>Bulk domain DGA analysis</td>
                    <td>domains (list)</td>
                </tr>
                <tr>
                    <td><code>generate_threat_feed</code></td>
                    <td>Create threat feed from indicators</td>
                    <td>indicators (list), format (str)</td>
                </tr>
                <tr>
                    <td><code>export_to_stix</code></td>
                    <td>Export indicators as STIX 2.1 bundle</td>
                    <td>indicators (list)</td>
                </tr>
            </tbody>
        </table>

        <h3>Claude Desktop Configuration</h3>
        <pre>
<span class="code-comment">// ~/.config/claude-desktop/claude_desktop_config.json</span>
{
    <span class="code-string">"mcpServers"</span>: {
        <span class="code-string">"tcpwave-misp"</span>: {
            <span class="code-string">"command"</span>: <span class="code-string">"python"</span>,
            <span class="code-string">"args"</span>: [<span class="code-string">"/path/to/misp-modules/mcp_server.py"</span>]
        }
    }
}
        </pre>

        <h3>Running the MCP Server</h3>
        <pre>
<span class="code-comment"># Standalone MCP server (stdio mode for Claude Desktop)</span>
python mcp_server.py

<span class="code-comment"># Or with SSE transport for web clients</span>
python mcp_server.py --transport sse --port 8080
        </pre>
    </section>

    <!-- Installation Section -->
    <section id="installation">
        <h2>Installation</h2>

        <h3>Requirements</h3>
        <ul>
            <li>Python 3.11 or higher</li>
            <li>pip package manager</li>
            <li>Optional: ATLANTIS DGA service running on port 8888</li>
        </ul>

        <h3>Quick Install</h3>
        <pre>
<span class="code-comment"># Clone the repository</span>
git clone https://github.com/tcpwave/misp-modules.git
cd misp-modules

<span class="code-comment"># Create virtual environment</span>
python -m venv venv
source venv/bin/activate  <span class="code-comment"># Linux/macOS</span>
venv\Scripts\activate     <span class="code-comment"># Windows</span>

<span class="code-comment"># Install dependencies</span>
pip install -r requirements.txt

<span class="code-comment"># Run the server</span>
python server.py
        </pre>

        <h3>Dependencies</h3>
        <pre>
<span class="code-comment"># Core Web Framework</span>
fastapi>=0.109.0
uvicorn[standard]>=0.27.0
pydantic>=2.5.0
pydantic-settings>=2.1.0

<span class="code-comment"># HTTP Client</span>
httpx>=0.26.0
aiohttp>=3.9.0

<span class="code-comment"># FastMCP - Model Context Protocol</span>
mcp>=0.9.0

<span class="code-comment"># Caching</span>
redis>=5.0.0

<span class="code-comment"># Data Processing</span>
pandas>=2.0.0
numpy>=1.24.0

<span class="code-comment"># STIX/TAXII</span>
stix2>=3.0.0

<span class="code-comment"># Testing</span>
pytest>=7.4.0
pytest-asyncio>=0.23.0
        </pre>

        <h3>Docker Deployment</h3>
        <pre>
<span class="code-comment"># Build Docker image</span>
docker build -t tcpwave-misp-modules .

<span class="code-comment"># Run container</span>
docker run -d \
    -p 6666:6666 \
    -e ATLANTIS_URL=http://host.docker.internal:8888 \
    --name misp-modules \
    tcpwave-misp-modules
        </pre>
    </section>

    <!-- Configuration Section -->
    <section id="configuration">
        <h2>Configuration</h2>

        <p>Configuration is managed via environment variables or a <code>.env</code> file in the project root.</p>

        <h3>Environment Variables</h3>

        <table>
            <thead>
                <tr>
                    <th>Variable</th>
                    <th>Default</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>APP_NAME</code></td>
                    <td>TCPWave MISP Modules</td>
                    <td>Application name</td>
                </tr>
                <tr>
                    <td><code>HOST</code></td>
                    <td>0.0.0.0</td>
                    <td>Server bind address</td>
                </tr>
                <tr>
                    <td><code>PORT</code></td>
                    <td>6666</td>
                    <td>Server port</td>
                </tr>
                <tr>
                    <td><code>DEBUG</code></td>
                    <td>false</td>
                    <td>Enable debug mode</td>
                </tr>
                <tr>
                    <td><code>ATLANTIS_URL</code></td>
                    <td>http://localhost:8888</td>
                    <td>ATLANTIS DGA service URL</td>
                </tr>
                <tr>
                    <td><code>ATLANTIS_API_KEY</code></td>
                    <td>-</td>
                    <td>ATLANTIS API key (optional)</td>
                </tr>
                <tr>
                    <td><code>REDIS_URL</code></td>
                    <td>redis://localhost:6379/0</td>
                    <td>Redis cache URL</td>
                </tr>
                <tr>
                    <td><code>VIRUSTOTAL_API_KEY</code></td>
                    <td>-</td>
                    <td>VirusTotal API key</td>
                </tr>
                <tr>
                    <td><code>ABUSEIPDB_API_KEY</code></td>
                    <td>-</td>
                    <td>AbuseIPDB API key</td>
                </tr>
                <tr>
                    <td><code>SHODAN_API_KEY</code></td>
                    <td>-</td>
                    <td>Shodan API key</td>
                </tr>
                <tr>
                    <td><code>SLACK_WEBHOOK_URL</code></td>
                    <td>-</td>
                    <td>Slack webhook for notifications</td>
                </tr>
                <tr>
                    <td><code>SMTP_HOST</code></td>
                    <td>-</td>
                    <td>SMTP server for email alerts</td>
                </tr>
            </tbody>
        </table>

        <h3>Example .env File</h3>
        <pre>
<span class="code-comment"># Server Configuration</span>
HOST=0.0.0.0
PORT=6666
DEBUG=false

<span class="code-comment"># ATLANTIS Integration</span>
ATLANTIS_URL=http://localhost:8888
ATLANTIS_TIMEOUT=30

<span class="code-comment"># Threat Intelligence APIs</span>
VIRUSTOTAL_API_KEY=your-vt-api-key
ABUSEIPDB_API_KEY=your-abuseipdb-key
SHODAN_API_KEY=your-shodan-key

<span class="code-comment"># Notifications</span>
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx
SLACK_CHANNEL=#threat-intel

<span class="code-comment"># Caching</span>
REDIS_URL=redis://localhost:6379/0
ENABLE_CACHING=true
        </pre>
    </section>

    <!-- Testing Section -->
    <section id="testing">
        <h2>Testing &amp; QA</h2>

        <div class="alert alert-success">
            <strong>Test Status:</strong> All 54 tests passing with 100% success rate across 5 comprehensive test rounds.
        </div>

        <h3>Running Tests</h3>
        <pre>
<span class="code-comment"># Run all tests with pytest</span>
python -m pytest tests/ -v

<span class="code-comment"># Run the 5-round comprehensive test suite</span>
python tests/test_5_rounds.py

<span class="code-comment"># Run with coverage</span>
python -m pytest tests/ --cov=core --cov=modules --cov-report=html
        </pre>

        <h3>5-Round QA Test Results</h3>

        <div class="test-round">
            <h4>
                Round 1: Unit Tests - Core Framework
                <span class="badge badge-pass">12/12 PASS</span>
            </h4>
            <div class="test-items">
                <div class="test-item">Core imports</div>
                <div class="test-item">ModuleType enum</div>
                <div class="test-item">ModuleConfig</div>
                <div class="test-item">MISPAttribute</div>
                <div class="test-item">MISPAttribute enrichment</div>
                <div class="test-item">MISPEvent</div>
                <div class="test-item">MISPObject</div>
                <div class="test-item">ModuleResult success</div>
                <div class="test-item">ModuleResult error</div>
                <div class="test-item">Settings singleton</div>
                <div class="test-item">Settings nested</div>
                <div class="test-item">Custom exceptions</div>
            </div>
        </div>

        <div class="test-round">
            <h4>
                Round 2: Integration Tests - Registry &amp; Loader
                <span class="badge badge-pass">10/10 PASS</span>
            </h4>
            <div class="test-items">
                <div class="test-item">Module discovery</div>
                <div class="test-item">Module loading</div>
                <div class="test-item">Registry population</div>
                <div class="test-item">Get by type</div>
                <div class="test-item">Get by name</div>
                <div class="test-item">Get nonexistent</div>
                <div class="test-item">Initialize all</div>
                <div class="test-item">Get instance</div>
                <div class="test-item">Module info</div>
                <div class="test-item">Module info structure</div>
            </div>
        </div>

        <div class="test-round">
            <h4>
                Round 3: Functional Tests - Module Execution
                <span class="badge badge-pass">10/10 PASS</span>
            </h4>
            <div class="test-items">
                <div class="test-item">DNS Anomaly expansion</div>
                <div class="test-item">DNS Anomaly legitimate</div>
                <div class="test-item">Domain Intel expansion</div>
                <div class="test-item">IP Reputation expansion</div>
                <div class="test-item">ATLANTIS export</div>
                <div class="test-item">STIX export</div>
                <div class="test-item">Threat feed export</div>
                <div class="test-item">CSV import</div>
                <div class="test-item">STIX import</div>
                <div class="test-item">CSV export</div>
            </div>
        </div>

        <div class="test-round">
            <h4>
                Round 4: Edge Case Tests - Error Handling
                <span class="badge badge-pass">12/12 PASS</span>
            </h4>
            <div class="test-items">
                <div class="test-item">Empty domain</div>
                <div class="test-item">Long domain</div>
                <div class="test-item">Invalid IP</div>
                <div class="test-item">Private IP</div>
                <div class="test-item">Empty export</div>
                <div class="test-item">No IOCs export</div>
                <div class="test-item">Invalid CSV</div>
                <div class="test-item">Invalid STIX JSON</div>
                <div class="test-item">Wrong attr type</div>
                <div class="test-item">Unicode/IDN domain</div>
                <div class="test-item">Special chars domain</div>
                <div class="test-item">None handling</div>
            </div>
        </div>

        <div class="test-round">
            <h4>
                Round 5: Performance Tests - Load Testing
                <span class="badge badge-pass">10/10 PASS</span>
            </h4>
            <div class="test-items">
                <div class="test-item">Batch 10 domains (0.1ms/domain)</div>
                <div class="test-item">Batch 50 domains (3ms total)</div>
                <div class="test-item">Export 100 attrs (1ms)</div>
                <div class="test-item">Export 10 events (2ms)</div>
                <div class="test-item">Import 200 IOCs (1ms)</div>
                <div class="test-item">Concurrent 20 (1ms)</div>
                <div class="test-item">100x moduleinfo (1ms)</div>
                <div class="test-item">16,000 lookups (1ms)</div>
                <div class="test-item">100x serialize (4ms)</div>
                <div class="test-item">1,000 events (11ms)</div>
            </div>
        </div>

        <h3>Performance Benchmarks</h3>
        <table>
            <thead>
                <tr>
                    <th>Operation</th>
                    <th>Performance</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>DNS Anomaly Analysis</td>
                    <td>~0.1ms/domain</td>
                    <td>Pure Python, no external calls</td>
                </tr>
                <tr>
                    <td>ATLANTIS DGA Query</td>
                    <td>~50ms/domain</td>
                    <td>Depends on ATLANTIS service</td>
                </tr>
                <tr>
                    <td>STIX Export (100 attrs)</td>
                    <td>~2ms</td>
                    <td>JSON serialization</td>
                </tr>
                <tr>
                    <td>CSV Import (200 IOCs)</td>
                    <td>~1ms</td>
                    <td>Parsing and validation</td>
                </tr>
                <tr>
                    <td>Registry Lookup</td>
                    <td>~0.06μs</td>
                    <td>O(1) dictionary access</td>
                </tr>
                <tr>
                    <td>Event Serialization</td>
                    <td>~0.04ms</td>
                    <td>50 attributes per event</td>
                </tr>
            </tbody>
        </table>
    </section>

    <!-- Examples Section -->
    <section id="examples">
        <h2>Usage Examples</h2>

        <h3>Python: Using the Module Registry</h3>
        <pre>
<span class="code-keyword">import</span> asyncio
<span class="code-keyword">from</span> core <span class="code-keyword">import</span> module_registry, MISPAttribute

<span class="code-keyword">async def</span> <span class="code-function">analyze_domain</span>(domain: str):
    <span class="code-comment"># Initialize modules</span>
    <span class="code-keyword">await</span> module_registry.initialize_all()

    <span class="code-comment"># Get the DNS anomaly module</span>
    module = <span class="code-keyword">await</span> module_registry.get_instance(<span class="code-string">"dns_anomaly"</span>)

    <span class="code-comment"># Create attribute and analyze</span>
    attr = MISPAttribute(<span class="code-keyword">type</span>=<span class="code-string">"domain"</span>, value=domain)
    result = <span class="code-keyword">await</span> module.expand(attr, {})

    <span class="code-keyword">if</span> result.success:
        <span class="code-keyword">for</span> attr <span class="code-keyword">in</span> result.attributes:
            <span class="code-keyword">print</span>(f<span class="code-string">"{attr.type}: {attr.value}"</span>)

    <span class="code-keyword">return</span> result

<span class="code-comment"># Run analysis</span>
asyncio.run(analyze_domain(<span class="code-string">"suspicious-domain.com"</span>))
        </pre>

        <h3>Python: Exporting to STIX</h3>
        <pre>
<span class="code-keyword">import</span> asyncio
<span class="code-keyword">from</span> core <span class="code-keyword">import</span> module_registry, MISPEvent, MISPAttribute

<span class="code-keyword">async def</span> <span class="code-function">export_to_stix</span>():
    <span class="code-keyword">await</span> module_registry.initialize_all()

    <span class="code-comment"># Create event with indicators</span>
    event = MISPEvent(info=<span class="code-string">"Threat Report 2024-001"</span>)
    event.add_attribute(MISPAttribute(
        <span class="code-keyword">type</span>=<span class="code-string">"domain"</span>,
        value=<span class="code-string">"malware-c2.com"</span>,
        to_ids=<span class="code-keyword">True</span>,
        tags=[<span class="code-string">"malware:emotet"</span>]
    ))
    event.add_attribute(MISPAttribute(
        <span class="code-keyword">type</span>=<span class="code-string">"ip-dst"</span>,
        value=<span class="code-string">"192.168.1.100"</span>,
        to_ids=<span class="code-keyword">True</span>
    ))

    <span class="code-comment"># Export to STIX</span>
    module = <span class="code-keyword">await</span> module_registry.get_instance(<span class="code-string">"stix_export"</span>)
    result = <span class="code-keyword">await</span> module.export([event], {})

    <span class="code-keyword">if</span> result.success:
        <span class="code-keyword">print</span>(result.data)  <span class="code-comment"># STIX 2.1 JSON bundle</span>

    <span class="code-keyword">return</span> result

asyncio.run(export_to_stix())
        </pre>

        <h3>cURL: REST API Query</h3>
        <pre>
<span class="code-comment"># Analyze a domain for DGA patterns</span>
curl -X POST http://localhost:6666/query \
  -H "Content-Type: application/json" \
  -d '{
    "module": "atlantis_dga",
    "attribute": {
      "type": "domain",
      "value": "xk3jsd9fj2kl3sdfj3ksd.com"
    }
  }'

<span class="code-comment"># Get DNS anomaly analysis</span>
curl -X POST http://localhost:6666/query \
  -H "Content-Type: application/json" \
  -d '{
    "module": "dns_anomaly",
    "attribute": {
      "type": "domain",
      "value": "suspicious-domain.com"
    }
  }'

<span class="code-comment"># List all modules</span>
curl http://localhost:6666/modules

<span class="code-comment"># Get server stats</span>
curl http://localhost:6666/stats
        </pre>

        <h3>JavaScript: Fetch API</h3>
        <pre>
<span class="code-comment">// Analyze domain using the REST API</span>
<span class="code-keyword">async function</span> <span class="code-function">analyzeDomain</span>(domain) {
    <span class="code-keyword">const</span> response = <span class="code-keyword">await</span> fetch(<span class="code-string">'http://localhost:6666/query'</span>, {
        method: <span class="code-string">'POST'</span>,
        headers: {
            <span class="code-string">'Content-Type'</span>: <span class="code-string">'application/json'</span>
        },
        body: JSON.stringify({
            module: <span class="code-string">'dns_anomaly'</span>,
            attribute: {
                type: <span class="code-string">'domain'</span>,
                value: domain
            }
        })
    });

    <span class="code-keyword">const</span> result = <span class="code-keyword">await</span> response.json();

    <span class="code-keyword">if</span> (result.success) {
        console.log(<span class="code-string">'Analysis results:'</span>, result.results);
    } <span class="code-keyword">else</span> {
        console.error(<span class="code-string">'Error:'</span>, result.error);
    }

    <span class="code-keyword">return</span> result;
}

<span class="code-comment">// Usage</span>
analyzeDomain(<span class="code-string">'test-domain.com'</span>);
        </pre>

        <h3>MISP Integration</h3>
        <pre>
<span class="code-comment"># In MISP's misp-modules configuration</span>
<span class="code-comment"># /etc/misp-modules/config.py</span>

MODULES_URL = <span class="code-string">"http://localhost:6666"</span>

<span class="code-comment"># Or add to MISP settings via web UI:</span>
<span class="code-comment"># Administration → Server Settings → Plugin Settings</span>
<span class="code-comment"># Set "Enrichment" → "Module_server" to http://localhost:6666</span>
        </pre>
    </section>

</div>

<footer>
    <p><strong>TCPWave MISP Modules v1.0.0</strong></p>
    <p>Powered by ATLANTIS AI Deep Learning | Built with FastAPI &amp; FastMCP</p>
    <p>Documentation generated: December 2025</p>
    <p><a href="https://tcpwave.com">tcpwave.com</a> | <a href="https://github.com/tcpwave">GitHub</a></p>
</footer>

</body>
</html>
